<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <title>NEON LIFE</title>
  <!-- DEMO_META
  title: NEON LIFE
  desc: ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã§ã‚­ãƒ£ãƒªã‚¢â†’24hé…åˆ†â†’å› æœãŒæ­ªã‚€äººç”Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
  tech: React, Canvas, DragAndDrop, LocalStorage
  level: 85
  color: #3b82f6
  type: game
  -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Syne+Mono&family=Nunito:wght@300;400;600&display=swap');

    /* ãƒªã‚»ãƒƒãƒˆ & ãƒ™ãƒ¼ã‚¹ */
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{width:100%;min-height:100vh;background:#030509;color:rgba(255,255,255,0.8);
      font-family:'Nunito',sans-serif;font-weight:300;-webkit-font-smoothing:antialiased}

    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤º */
    ::-webkit-scrollbar{display:none}

    /* ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚´ãƒ¼ã‚¹ãƒˆã‚’é€æ˜ã« */
    [draggable=true]{-webkit-user-drag:element}

    /* fadeIn */
    @keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}

    /* ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³ (å¤œã®æ±äº¬ã®æ±‚äººèªŒ aesthetic) */
    body::before{
      content:'';position:fixed;inset:0;z-index:9999;pointer-events:none;
      background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,0,0,0.04)3px,rgba(0,0,0,0.04)4px);
    }

    /* ç’°å¢ƒå…‰: ãƒã‚ªãƒ³ãƒ–ãƒ«ãƒ¼ãŒç©ºé–“ã«æ»²ã‚€ */
    body::after{
      content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
      background:radial-gradient(ellipse 80% 40% at 50% 100%,rgba(59,130,246,0.06)0%,transparent 70%);
    }

    #root{position:relative;z-index:1}

    /* ãƒœã‚¿ãƒ³å…±é€š */
    button{outline:none}
    button:focus-visible{outline:2px solid rgba(59,130,246,0.5)}
  </style>
</head>
<body>
<div id="root"></div>
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  NEON LIFE â€” å®Œå…¨å®Ÿè£…
//  è¨­è¨ˆæ‹˜æŸ: æ­£è§£ãŒæ¶ˆãˆã‚‹æ§‹é€  / å› æœãŒæ­ªã‚€äººç”Ÿ / FIREã¯é€€å±ˆãƒ•ã‚§ãƒ¼ã‚º
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NEON LIFE â€” DATA & LOGIC LAYER
//  è¨­è¨ˆåŸå‰‡: ã€Œæ­£è§£ãŒå­˜åœ¨ã—ãªã„ã€ã“ã¨ã‚’ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‹ã‚‰ä¿è¨¼ã™ã‚‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€ è·æ¥­å®šç¾© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// è·æ¥­ = åå…¥æºã§ã¯ãªãã€Œã‚¤ãƒ™ãƒ³ãƒˆåˆ†å¸ƒã‚’æ­ªã‚ã‚‹ã‚¿ã‚°ã€
const JOBS = [
  {
    id:'salaryman', name:'ä¼šç¤¾å“¡', icon:'ğŸ¢',
    baseIncome: 380000,
    incomeVariance: 0.05,   // å®‰å®šã®ä»£å„Ÿã¯åœæ»
    eventTags: ['org','stability','slowburn'],
    desc: 'çµ„ç¹”ã®æ­¯è»Šã€‚å®‰å…¨ã ãŒã€æ°—ã¥ã‘ã°10å¹´çµŒã£ã¦ã„ã‚‹',
    hiddenEffect: { socialCredit: +0.8, fatigue: +0.3, eraFit: -0.1 },
  },
  {
    id:'entrepreneur', name:'èµ·æ¥­å®¶', icon:'ğŸ”¥',
    baseIncome: 0,           // åå…¥ã¯0ã‹ã‚‰ã€‚æˆåŠŸã™ã‚Œã°é’å¤©äº•
    incomeVariance: 3.0,
    eventTags: ['risk','pivot','explosion'],
    desc: 'å…¨ã‹ç„¡ã‹ã€‚æˆåŠŸç‡ã¯ä½ã„ãŒã€å¤±æ•—ã—ãŸè©±ã®æ–¹ãŒé¢ç™½ã„',
    hiddenEffect: { socialCredit: +0.2, fatigue: +0.8, eraFit: +0.5 },
  },
  {
    id:'investor', name:'æŠ•è³‡å®¶', icon:'ğŸ“ˆ',
    baseIncome: 0,           // è³‡ç”£ãŒãªã„ã¨æ©Ÿèƒ½ã—ãªã„
    incomeVariance: 2.0,
    eventTags: ['market','compound','volatility'],
    desc: 'å¸‚å ´ãŒäººç”Ÿã®ä¸»èªã«ãªã‚‹ã€‚è‡ªåˆ†ã®æ„å¿—ãŒæ¶ˆãˆã¦ã„ã',
    hiddenEffect: { socialCredit: +0.5, fatigue: -0.2, eraFit: +0.3 },
  },
  {
    id:'landlord', name:'ä¸å‹•ç”£ç‹', icon:'ğŸ ',
    baseIncome: 200000,
    incomeVariance: 0.3,
    eventTags: ['debt','passive','crisis'],
    desc: 'ä»–äººã®å®¶è³ƒã§ç”Ÿãã‚‹ã€‚å€Ÿé‡‘ã‚‚ä»–äººã®è¦æ¨¡ã§è†¨ã‚‰ã‚€',
    hiddenEffect: { socialCredit: +0.6, fatigue: +0.1, eraFit: -0.2 },
  },
  {
    id:'influencer', name:'ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼', icon:'âœ¨',
    baseIncome: 0,
    incomeVariance: 4.0,
    eventTags: ['viral','burnout','parasocial'],
    desc: 'ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ãŒè³‡ç”£ã€‚ç‚ä¸Šã‚‚è³‡ç”£ã€‚æ¶ˆãˆãŸæ™‚ã¯ä¸€ç¬',
    hiddenEffect: { socialCredit: -0.3, fatigue: +1.2, eraFit: +0.8 },
  },
  {
    id:'freelancer', name:'ãƒ•ãƒªãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', icon:'ğŸ’»',
    baseIncome: 600000,
    incomeVariance: 0.8,
    eventTags: ['gig','isolation','skill'],
    desc: 'è‡ªç”±ã®ä»£å„Ÿã¯å­¤ç‹¬ã¨ä¸å®‰å®šã€‚æ¡ˆä»¶ã‚¬ãƒãƒ£ãŒç¶šã',
    hiddenEffect: { socialCredit: +0.0, fatigue: +0.4, eraFit: +0.6 },
  },
];

// â”€â”€â”€ è¡Œå‹•ã‚«ãƒ¼ãƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1ã‚¹ãƒ­ãƒƒãƒˆ(1æ™‚é–“)ã«é…ç½®ã™ã‚‹è¡Œå‹•
// ã€ŒåŠ¹æœãŒæ˜ç¢ºã«è¦‹ãˆãªã„ã€ã‚‚ã®ã‚’æ„å›³çš„ã«å«ã‚ã‚‹
const ACTIONS = [
  // ç”Ÿå­˜ç³»
  { id:'sleep', name:'ç¡çœ ', icon:'ğŸŒ™', hours:1, category:'survival',
    effect:{energy:+0.15}, cost:0,
    desc:'å¿…è¦ã€‚ã ãŒå‰Šã‚Œã‚‹æ°—ãŒã—ã¦ã—ã¾ã†' },
  { id:'meal', name:'é£Ÿäº‹', icon:'ğŸ±', hours:1, category:'survival',
    effect:{energy:+0.05, social:+0.02}, cost:1000,
    desc:'ã‚³ãƒ³ãƒ“ãƒ‹ã‹å¤–é£Ÿã‹ã€‚ä½•ã‚’é£Ÿã¹ãŸã‹ã§ä½•ã‹ãŒå¤‰ã‚ã‚‹' },

  // ä»•äº‹ç³»
  { id:'work_core', name:'æœ¬æ¥­', icon:'âš¡', hours:1, category:'work',
    effect:{income:+1.0, fatigue:+0.08},
    desc:'æ™‚é–“ãŒé‡‘ã«ãªã‚‹ã€‚ãŸã ã—ç­‰ä¾¡ã§ã¯ãªã„' },
  { id:'work_extra', name:'æ®‹æ¥­', icon:'ğŸŒƒ', hours:1, category:'work',
    effect:{income:+0.8, fatigue:+0.15, social:-0.03},
    desc:'å‰²ã«åˆã‚ãªã„ã€‚ã§ã‚‚æ–­ã‚Œãªã„' },
  { id:'side_hustle', name:'å‰¯æ¥­', icon:'ğŸ”§', hours:1, category:'work',
    effect:{income:+0.3, fatigue:+0.1, skill:+0.05},
    desc:'ç–²ã‚ŒãŸä½“ã§ã‚‚ã†ä¸€ä»•äº‹ã€‚ã„ã¤ã‹é€†è»¢ã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„' },

  // æŠ•è³‡ãƒ»è³‡ç”£ç³»
  { id:'study_invest', name:'æŠ•è³‡å‹‰å¼·', icon:'ğŸ“Š', hours:1, category:'invest',
    effect:{skill:+0.1, eraFit:+0.03},
    cost:0, desc:'çŸ¥è­˜ãŒå¢—ãˆã‚‹ã€‚å‹ç‡ã¯ä¸ŠãŒã‚‹ã€‚ã§ã‚‚å¸‚å ´ã¯å¤‰ã‚ã‚‹' },
  { id:'trade', name:'æ ªå–å¼•', icon:'ğŸ’¹', hours:1, category:'invest',
    effect:{income_volatile:true}, cost:0,
    desc:'é‹ã¨å®ŸåŠ›ã®åŒºåˆ¥ãŒã¤ã‹ãªã„ã€‚ãã‚ŒãŒã„ã„' },
  { id:'networking', name:'äººè„ˆå½¢æˆ', icon:'ğŸ¤', hours:1, category:'social',
    effect:{social:+0.08, fatigue:+0.03}, cost:5000,
    desc:'ç¹‹ãŒã‚Šã¯è¦‹ãˆãªã„è³‡ç”£ã€‚ä½¿ãˆã‚‹ã‹ã¯çŠ¶æ³æ¬¡ç¬¬' },

  // è‡ªå·±æŠ•è³‡ç³»
  { id:'gym', name:'ã‚¸ãƒ ', icon:'ğŸ’ª', hours:1, category:'health',
    effect:{energy:+0.08, fatigue:-0.1}, cost:2000,
    desc:'ä½“ã¯æ­£ç›´ã€‚ã§ã‚‚æˆæœã¯é…ã‚Œã¦ã‚„ã£ã¦ãã‚‹' },
  { id:'learn', name:'ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—', icon:'ğŸ“š', hours:1, category:'growth',
    effect:{skill:+0.12, eraFit:+0.05}, cost:3000,
    desc:'ä»Šã®æ­£è§£ãŒ10å¹´å¾Œã®æ­£è§£ã¨ã¯é™ã‚‰ãªã„' },
  { id:'meditate', name:'ç‘æƒ³', icon:'ğŸ§˜', hours:1, category:'health',
    effect:{fatigue:-0.15, luck:+0.02},
    desc:'ä½•ã‚‚ã—ãªã„æ™‚é–“ã€‚ä½•ã‹ãŒå¤‰ã‚ã‚‹æ°—ãŒã™ã‚‹' },
  { id:'drink', name:'é£²ã¿ä¼š', icon:'ğŸ»', hours:1, category:'social',
    effect:{social:+0.12, fatigue:+0.08, energy:-0.05}, cost:5000,
    desc:'ç¿Œæ—¥ã«æ®‹ã‚‹ã€‚é–¢ä¿‚æ€§ã«ã‚‚æ®‹ã‚‹' },
  { id:'game', name:'ã‚²ãƒ¼ãƒ ', icon:'ğŸ®', hours:1, category:'leisure',
    effect:{fatigue:-0.05, social:-0.01, eraFit:+0.01},
    desc:'é€ƒã’ã¦ã„ã‚‹ã€‚ãã‚ŒãŒæ‚ªã„ã¨ã¯è¨€ã£ã¦ã„ãªã„' },
  { id:'family', name:'å®¶æ—æ™‚é–“', icon:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', hours:1, category:'social',
    effect:{social:+0.15, luck:+0.03, fatigue:-0.05},
    desc:'æ•°å€¤ã«ç¾ã‚Œãªã„ä½•ã‹ãŒå¢—ãˆã¦ã„ã' },
  { id:'travel', name:'æ—…è¡Œ', icon:'âœˆï¸', hours:4, category:'leisure',
    effect:{eraFit:+0.1, fatigue:-0.2, social:+0.1}, cost:80000,
    desc:'è¦–é‡ãŒå¤‰ã‚ã‚‹ã€‚å¤‰ã‚ã£ãŸã‹ã©ã†ã‹ã¯å¾Œã§ã‚ã‹ã‚‹' },
  { id:'volunteer', name:'ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢', icon:'ğŸŒ±', hours:2, category:'social',
    effect:{social:+0.2, luck:+0.05}, cost:0,
    desc:'è¦‹è¿”ã‚Šã¯ç¢ºç‡ã§æ¥ã‚‹ã€‚æ¥ãªã„ã“ã¨ã‚‚ã‚ã‚‹' },
];

// â”€â”€â”€ å¸‚å ´ãƒ•ã‚§ãƒ¼ã‚º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å¤‰ãˆã‚‰ã‚Œãªã„ã€‚ãŸã å¯¾å¿œã™ã‚‹ã‹ã€é€†å¼µã‚Šã™ã‚‹ã‹ã ã‘
const MARKET_PHASES = [
  { id:'bull', name:'ğŸ‚ ãƒãƒ–ãƒ«æœŸ', multiplier:1.4, risk:1.6,
    desc:'ãªã‚“ã§ã‚‚ä¸ŠãŒã‚‹ã€‚ä¸ŠãŒã‚Šã™ãã¦ã„ã‚‹',
    favors:['investor','entrepreneur','influencer'] },
  { id:'bear', name:'ğŸ» ä¸æ³æœŸ', multiplier:0.6, risk:0.8,
    desc:'è€ãˆã‚‹è€…ã ã‘ãŒæ¬¡ã‚’è¦‹ã‚‹',
    favors:['salaryman','landlord'] },
  { id:'stable', name:'ğŸ“Š å®‰å®šæœŸ', multiplier:1.0, risk:1.0,
    desc:'å¹³å’Œã€‚åˆºæ¿€ãŒãªã„ã€‚ä½•ã‹ãŒç©ã¿ä¸ŠãŒã£ã¦ã„ã‚‹',
    favors:['salaryman','freelancer'] },
  { id:'disruption', name:'âš¡ å¤‰é©æœŸ', multiplier:1.2, risk:2.0,
    desc:'å¤ã„æ­£è§£ãŒæ­»ã¬æ™‚ä»£ã€‚æ–°ã—ã„æ­£è§£ã¯ã¾ã èª°ã‚‚çŸ¥ã‚‰ãªã„',
    favors:['entrepreneur','influencer','investor'] },
  { id:'crisis', name:'ğŸŒª å±æ©Ÿ', multiplier:0.4, risk:0.5,
    desc:'å…¨å“¡ãŒç­‰ã—ãæ‰“æ’ƒã‚’å—ã‘ã‚‹ã‚ã‘ã§ã¯ãªã„',
    favors:['landlord'] },
];

// â”€â”€â”€ ç¤¾ä¼šãƒ ãƒ¼ãƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SOCIAL_MOODS = [
  { id:'optimism', name:'æ¥½è¦³ãƒ ãƒ¼ãƒ‰', eventBias:'positive', luckMod:+0.15 },
  { id:'anxiety', name:'ä¸å®‰ãƒ ãƒ¼ãƒ‰', eventBias:'negative', luckMod:-0.1 },
  { id:'hustle', name:'åŠªåŠ›ä¿¡ä»°', eventBias:'work', luckMod:0 },
  { id:'wellness', name:'ã‚¦ã‚§ãƒ«ãƒ“ãƒ¼ã‚¤ãƒ³ã‚°', eventBias:'balance', luckMod:+0.05 },
  { id:'nihilism', name:'è™šç„¡æ„Ÿ', eventBias:'random', luckMod:-0.05 },
];

// â”€â”€â”€ ã‚¤ãƒ™ãƒ³ãƒˆãƒ—ãƒ¼ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ã€Œæ˜ç¢ºãªæ­£è§£ãƒ»ä¸æ­£è§£ã¯ç¦æ­¢ã€
// ã€ŒæˆåŠŸã—ã¦ã‚‚å¾Œæ‚”ã®ç¨®ã‚’æ®‹ã™ã€ã€Œå¤±æ•—ã—ã¦ã‚‚èªã‚Œã‚‹ç‰©èªã‚’æ®‹ã™ã€
const EVENTS = [
  // ã‚­ãƒ£ãƒªã‚¢
  { id:'promotion', name:'æ˜‡é€²', icon:'â¬†ï¸',
    trigger:{tags:['org'], minMonth:6},
    choices:[
      { label:'å—ã‘ã‚‹', effect:{income:+0.2, fatigue:+0.2, social:+0.1},
        narrative:'è‚©æ›¸ããŒå¢—ãˆãŸã€‚ãã‚Œã ã‘ã§ã¯ãªã„ãŒã€ãã‚Œã ã‘ã‹ã‚‚ã—ã‚Œãªã„' },
      { label:'æ–­ã‚‹', effect:{socialCredit:-0.1, fatigue:-0.1, eraFit:+0.05},
        narrative:'çã—ã„é¸æŠã€‚çµ„ç¹”ã¯ãã‚Œã‚’è¦šãˆã¦ã„ã‚‹' },
    ]},
  { id:'layoff', name:'ãƒªã‚¹ãƒˆãƒ©', icon:'ğŸ“‹',
    trigger:{tags:['org','bear'], probability:0.3},
    choices:[
      { label:'äº¤æ¸‰ã™ã‚‹', effect:{income:-0.1, socialCredit:+0.05},
        narrative:'å°‘ã—å®ˆã£ãŸã€‚ã—ã‹ã—æ³¢é¢¨ã¯ç«‹ã£ãŸ' },
      { label:'å—ã‘å…¥ã‚Œã‚‹', effect:{income:-0.5, fatigue:-0.3, eraFit:+0.1},
        narrative:'å¤–ã«å‡ºãŸã€‚ä¸–ç•ŒãŒå°‘ã—åºƒãè¦‹ãˆãŸ' },
    ]},
  { id:'startup_offer', name:'ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰ã‚ªãƒ•ã‚¡ãƒ¼', icon:'ğŸš€',
    trigger:{tags:['disruption'], probability:0.25},
    choices:[
      { label:'è»¢è·ã™ã‚‹', effect:{income_volatile:true, fatigue:+0.3, eraFit:+0.2},
        narrative:'è³­ã‘ã«å‡ºãŸã€‚çµæœã¯åŠå¹´å¾Œã«ã‚ã‹ã‚‹' },
      { label:'ç•™ã¾ã‚‹', effect:{social:+0.05, eraFit:-0.1},
        narrative:'å®‰å…¨ã‚’é¸ã‚“ã ã€‚å¾Œæ‚”ã—ãªã„ã‹ã¯æœªæ¥ã®è‡ªåˆ†ã«èã„ã¦ãã‚Œ' },
    ]},

  // å¸‚å ´
  { id:'market_crash', name:'å¸‚å ´æš´è½', icon:'ğŸ“‰',
    trigger:{tags:['investor','bear'], probability:0.4},
    choices:[
      { label:'æåˆ‡ã‚Š', effect:{asset:-0.2, fatigue:+0.1},
        narrative:'ç¢ºå®šã—ãŸæå¤±ã€‚ã—ã‹ã—æ¬¡ã®ä¸€æ‰‹ãŒæ‰“ã¦ã‚‹' },
      { label:'ãƒ›ãƒ¼ãƒ«ãƒ‰', effect:{luck_roll:true},
        narrative:'ä¿¡ã˜ã‚‹è€…ã ã‘ãŒè¦‹ã‚‹å…‰æ™¯ãŒã‚ã‚‹ã€‚ã‚ã‚‹ã„ã¯æš—é—‡ã ã‘ãŒã‚ã‚‹' },
    ]},
  { id:'windfall', name:'äºˆæœŸã›ã¬åˆ©ç›Š', icon:'ğŸ’°',
    trigger:{probability:0.1},
    choices:[
      { label:'å†æŠ•è³‡', effect:{asset:+0.3, risk:+0.2},
        narrative:'å¢—ã‚„ã—ãŸã€‚æ¬¡ã«æ¸›ã‚‹æº–å‚™ã‚‚æ•´ã£ãŸ' },
      { label:'ä½¿ã†', effect:{fatigue:-0.2, social:+0.2, asset:+0.05},
        narrative:'æ¶ˆè²»ã—ãŸã€‚è¨˜æ†¶ã«å¤‰ã‚ã£ãŸ' },
    ]},

  // äººé–“é–¢ä¿‚
  { id:'mentor', name:'å¸«åŒ ã«å‡ºä¼šã†', icon:'ğŸ§™',
    trigger:{tags:['networking','stable'], probability:0.15},
    choices:[
      { label:'å¼Ÿå­å…¥ã‚Š', effect:{skill:+0.3, income:-0.1, socialCredit:+0.2},
        narrative:'æ•™ã‚ã‚‹ã“ã¨ã¨å¤±ã†ã“ã¨ã¯åŒæ™‚ã«èµ·ãã‚‹' },
      { label:'ç¤¼å„€ã ã‘', effect:{social:+0.05},
        narrative:'æ©Ÿä¼šã‚’å¤§åˆ‡ã«ã—ãªã‹ã£ãŸã€‚ãã‚Œã‚‚é¸æŠã ' },
    ]},
  { id:'betrayal', name:'è£åˆ‡ã‚Š', icon:'ğŸ—¡ï¸',
    trigger:{tags:['risk','org'], probability:0.2},
    choices:[
      { label:'æˆ¦ã†', effect:{income:-0.1, fatigue:+0.3, socialCredit:+0.1},
        narrative:'æ¶ˆè€—ã—ãŸã€‚æ­£ã—ã‹ã£ãŸã‹ã©ã†ã‹ã¯æ­´å²ãŒæ±ºã‚ã‚‹' },
      { label:'å»ã‚‹', effect:{income:-0.2, fatigue:-0.2, eraFit:+0.15},
        narrative:'è³¢ã„æ’¤é€€ã‹ã€é€ƒã’ã‹ã€‚è‡ªåˆ†ã§ã‚‚åˆ¤æ–­ã§ããªã„' },
    ]},
  { id:'viral_moment', name:'ãƒã‚ºã‚‹', icon:'ğŸŒŠ',
    trigger:{tags:['viral','influencer'], probability:0.3},
    choices:[
      { label:'ä¹—ã‚‹', effect:{income:+0.5, fatigue:+0.4, socialCredit:-0.1},
        narrative:'æ³¨ç›®ã¯çŸ­ã„ã€‚æ¶ˆè²»ã•ã‚Œã‚‹ã“ã¨ãŒä»•äº‹ã«ãªã£ãŸ' },
      { label:'ç„¡è¦–ã™ã‚‹', effect:{eraFit:+0.1, socialCredit:+0.05},
        narrative:'ã‚ã®æ³¢ã«ä¹—ã‚‰ãªã‹ã£ãŸäººé–“ã¨ã—ã¦è¦šãˆã‚‰ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„' },
    ]},

  // ç¤¾ä¼š
  { id:'tax_audit', name:'ç¨å‹™èª¿æŸ»', icon:'ğŸ›ï¸',
    trigger:{tags:['landlord','investor'], probability:0.15},
    choices:[
      { label:'æ­£ç›´ã«', effect:{asset:-0.1, socialCredit:+0.1},
        narrative:'æ‰•ã£ãŸã€‚æ¸…å»‰ã ã£ãŸã€‚ãã‚ŒãŒå¾—ã‹ã©ã†ã‹ã¯åˆ¥ã®è©±' },
      { label:'ã‚°ãƒ¬ãƒ¼å¯¾å¿œ', effect:{luck_roll:true, fatigue:+0.2},
        narrative:'ãƒªã‚¹ã‚¯ã‚’é¸ã‚“ã ã€‚é‹ã¨æ³•å¾‹ã®ä¸¡æ–¹ãŒå¯©åˆ¤ã™ã‚‹' },
    ]},
  { id:'economic_change', name:'æ™‚ä»£ã®å¤‰åŒ–', icon:'ğŸŒ',
    trigger:{probability:0.2},
    choices:[
      { label:'é©å¿œã™ã‚‹', effect:{skill:+0.2, eraFit:+0.3, income:-0.1},
        narrative:'å¤‰ã‚ã£ãŸã€‚ä½•ã‚’å¤±ã£ãŸã‹ã¯å¾Œã§ã‚ã‹ã‚‹' },
      { label:'æŠµæŠ—ã™ã‚‹', effect:{income:+0.05, eraFit:-0.2, socialCredit:-0.1},
        narrative:'è‡ªåˆ†ã‚’å®ˆã£ãŸã€‚ä¸–ç•ŒãŒå…ˆã«è¡Œã£ãŸ' },
    ]},

  // ç§ç”Ÿæ´»
  { id:'health_crisis', name:'ä½“ã®ç•°å¤‰', icon:'ğŸ¥',
    trigger:{minFatigue:0.7, probability:0.35},
    choices:[
      { label:'å…¥é™¢ãƒ»æ²»ç™‚', effect:{fatigue:-0.4, asset:-0.15, income:-0.3},
        narrative:'å‘½ã‚’è²·ã„æˆ»ã—ãŸã€‚å€¤æ®µã¯å¾Œã‹ã‚‰åŠ¹ã„ã¦ãã‚‹' },
      { label:'ç„¡è¦–ã—ã¦ç¶šã‘ã‚‹', effect:{fatigue:+0.2, luck:-0.1},
        narrative:'ä¹—ã‚Šåˆ‡ã£ãŸã€‚ä»Šã¯ã€‚ä½“ã¯è¨˜éŒ²ã™ã‚‹' },
    ]},
  { id:'life_partner', name:'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã®è»¢æ©Ÿ', icon:'ğŸ’',
    trigger:{probability:0.15, minMonth:12},
    choices:[
      { label:'å‰é€²ã™ã‚‹', effect:{social:+0.3, income:-0.05, luck:+0.1},
        narrative:'äººç”Ÿã®é‡å¿ƒãŒå¤‰ã‚ã£ãŸ' },
      { label:'ç¾çŠ¶ç¶­æŒ', effect:{fatigue:+0.05, socialCredit:-0.05},
        narrative:'é¸ã°ãªã„ã“ã¨ã‚‚é¸æŠã ã£ãŸ' },
    ]},
  { id:'fire_temptation', name:'FIREã§ãã‚‹è³‡ç”£ã«è¿‘ã¥ã', icon:'ğŸ”¥',
    trigger:{minAsset:100000000, probability:0.9},
    choices:[
      { label:'ã¾ã åƒã', effect:{income:+0.1, fatigue:+0.1, eraFit:-0.05},
        narrative:'è‡ªåˆ†ãŒä½•è€…ã‹ã‚’ä»•äº‹ã§æ±ºã‚ã¦ã„ã‚‹ã€‚ã„ã¤ã¾ã§ã‚‚' },
      { label:'å¼•é€€ã‚’è€ƒãˆã‚‹', effect:{fatigue:-0.2, socialCredit:-0.1, luck:-0.05},
        narrative:'é€€å±ˆãŒæ¥ã‚‹ã€‚ãã‚ŒãŒæ¬¡ã®å•ã„ã«ãªã‚‹' },
    ]},
];

// â”€â”€â”€ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ†ãƒ¼ãƒ–ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ã€Œè¦‹ãŸç›®ã¯å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã€‚å®Ÿéš›ã¯è‡ªåˆ†ã§ç¢ºç‡ã‚’ä½œã£ã¦ã„ã‚‹ã€
const ROULETTE_EVENTS = [
  { id:'lucky_break', name:'å¹¸é‹ã®çªç ´å£', icon:'â­', type:'positive',
    effect:{asset:+0.15, income:+0.1},
    narrative:'æº–å‚™ã—ã¦ã„ãŸè€…ã«é‹ãŒæ¥ãŸã€‚æº–å‚™ã®å®šç¾©ã¯åºƒã„' },
  { id:'unexpected_loss', name:'äºˆæœŸã›ã¬æå¤±', icon:'ğŸ’¸', type:'negative',
    effect:{asset:-0.1},
    narrative:'ãªãœã‹ã‚ã‹ã‚‰ãªã„æå¤±ã€‚å¾Œã‹ã‚‰ç¹‹ãŒã£ã¦è¦‹ãˆã‚‹' },
  { id:'connection', name:'é‹å‘½çš„ãªå‡ºä¼šã„', icon:'ğŸŒŸ', type:'event',
    effect:{socialCredit:+0.2, luck:+0.1},
    narrative:'äººãŒäººç”Ÿã‚’å¤‰ãˆã‚‹ã€‚ãã‚Œã¯ä»Šæ—¥ã ã£ãŸã‹ã‚‚ã—ã‚Œãªã„' },
  { id:'market_surprise', name:'å¸‚å ´ã‚µãƒ—ãƒ©ã‚¤ã‚º', icon:'ğŸ“Š', type:'market',
    effect:{asset_volatile:true},
    narrative:'å¸‚å ´ã¯æ„Ÿæƒ…ã‚’æŒãŸãªã„ã€‚ãã‚ŒãŒæ€–ã„' },
  { id:'burnout', name:'ç‡ƒãˆå°½ã', icon:'ğŸ•¯ï¸', type:'negative',
    effect:{fatigue:+0.3, income:-0.1, eraFit:-0.1},
    narrative:'å…¨åŠ›ã ã£ãŸã€‚ã ã‹ã‚‰ç©ºã«ãªã£ãŸ' },
  { id:'breakthrough', name:'çªç„¶ã®è¦šé†’', icon:'ğŸ’¡', type:'positive',
    effect:{skill:+0.3, eraFit:+0.2},
    narrative:'ç‚¹ãŒç·šã«ãªã£ãŸç¬é–“ã€‚ã‚ã®æ—¥ãŒã‚ã£ãŸã‹ã‚‰' },
  { id:'inheritance', name:'ç›¸ç¶š', icon:'ğŸ›ï¸', type:'special',
    effect:{asset:+500000},
    narrative:'èª°ã‹ã®äººç”Ÿã®çµ‚ã‚ã‚ŠãŒå§‹ã¾ã‚Šã«ãªã£ãŸ' },
  { id:'scandal', name:'ã‚¹ã‚­ãƒ£ãƒ³ãƒ€ãƒ«', icon:'ğŸ“°', type:'negative',
    effect:{socialCredit:-0.4, income:-0.2},
    narrative:'å¿˜ã‚Œã‚‰ã‚Œãªã„å‡ºæ¥äº‹ã€‚ä¸–é–“ã‚‚å¿˜ã‚Œãªã„' },
  { id:'nothing', name:'é™ã‹ãªæœˆ', icon:'ğŸŒ™', type:'neutral',
    effect:{},
    narrative:'ä½•ã‚‚èµ·ããªã‹ã£ãŸã€‚ãã‚ŒãŒã©ã‚Œã»ã©è´…æ²¢ã‹' },
  { id:'trend_change', name:'æ™‚ä»£ã®é¢¨å‘ã', icon:'ğŸŒ€', type:'market',
    effect:{eraFit_change: true},
    narrative:'ç©ºæ°—ãŒå¤‰ã‚ã£ãŸã€‚æ°—ã¥ã„ãŸäººé–“ãŒæ¬¡ã®æ™‚ä»£ã‚’ä½œã‚‹' },
];

// â”€â”€â”€ æ°¸ç¶šåŒ–ã‚­ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STORAGE_KEY = 'neonlife_v1';

// éå»å‘¨å›ã®å› æœã‚’è¨˜éŒ²ã™ã‚‹ã€Œå¢“å ´ã€
function loadKarma() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : { runs: [], totalMonths: 0 };
  } catch { return { runs: [], totalMonths: 0 }; }
}

function saveKarma(karma) {
  try {
    // 10å‘¨å›åˆ†ã ã‘ä¿å­˜ï¼ˆã€Œ10å¹´åˆ†ã®å› æœã€ï¼‰
    const trimmed = { ...karma, runs: karma.runs.slice(-10) };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(trimmed));
  } catch {}
}

// éå»ã®å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ç¢ºç‡ã‚’æ­ªã‚ã‚‹
// ã€Œäººç”Ÿã¯è¨˜æ†¶ã•ã‚Œã€ä¸–ç•Œã¯å†·ãŸããªã‚‹ã€
function getKarmaModifiers(karma, currentJob) {
  if (!karma.runs.length) return { luckyMod: 0, eventBias: null };

  const recentRuns = karma.runs.slice(-3);
  // åŒã˜è·æ¥­ã§å¤±æ•—ã—ãŸå›æ•°
  const sameJobFailures = recentRuns.filter(r =>
    r.finalJob === currentJob && r.endReason === 'bankruptcy'
  ).length;

  // éå»ã«æˆåŠŸã—ãŸå‘¨å›ãŒã‚ã‚‹ã¨ã€ŒæˆåŠŸã‚¤ãƒ™ãƒ³ãƒˆã€ãŒå°‘ã—å‡ºã«ãããªã‚‹
  // ä¸–ç•Œã¯æ…£ã‚ŒãŸè€…ã«å³ã—ã„
  const successRuns = karma.runs.filter(r => r.endReason === 'fire').length;

  return {
    luckyMod: -0.08 * sameJobFailures + 0.05 * Math.min(2, successRuns),
    eventBias: sameJobFailures >= 2 ? 'adversity' : null,
  };
}

// â”€â”€â”€ ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function createInitialState(selectedJob, karma) {
  const karmaModifiers = getKarmaModifiers(karma, selectedJob.id);

  return {
    // æ™‚é–“
    month: 1,
    phase: 'timeline', // 'timeline' | 'event' | 'roulette' | 'settlement' | 'fire' | 'bankrupt'

    // å¯è¦–æ•°å€¤ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦‹ãˆã‚‹ï¼‰
    asset: 500000,      // 50ä¸‡å††ã‚¹ã‚¿ãƒ¼ãƒˆ
    monthlyIncome: 0,
    monthlyExpense: 0,
    job: selectedJob,
    timeline: Array(24).fill(null), // 24hã‚¹ãƒ­ãƒƒãƒˆ

    // éš ã—å†…éƒ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆUIã«è¡¨ç¤ºã—ãªã„ï¼‰
    _hidden: {
      socialCredit: 0.5,  // 0ã€œ1
      fatigue: 0.2,       // 0ã€œ1
      eraFit: 0.5,        // 0ã€œ1
      luck: 0.5 + karmaModifiers.luckyMod,
      skill: 0.3,
      karmaModifiers,
    },

    // å¸‚å ´ãƒ»ç¤¾ä¼š
    market: MARKET_PHASES[2], // å®‰å®šæœŸã‚¹ã‚¿ãƒ¼ãƒˆ
    mood: SOCIAL_MOODS[0],

    // ã‚¤ãƒ™ãƒ³ãƒˆ
    currentEvent: null,
    log: [], // äººç”Ÿã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°

    // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ
    rouletteResult: null,

    // çµ±è¨ˆï¼ˆå¾Œã‹ã‚‰èªã‚‹ãŸã‚ã®è¨˜éŒ²ï¼‰
    history: {
      assets: [500000],
      decisions: [],
      peakAsset: 500000,
      lowestMonth: null,
      eventsFaced: [],
    },

    // FIREçŠ¶æ…‹
    isFire: false,
    fireMonth: null,

    // é€£ç¶šèµ¤å­—ã‚«ã‚¦ãƒ³ãƒˆ
    redMonths: 0,
  };
}

// â”€â”€â”€ æœˆæœ«æ±ºç®— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calculateMonthEnd(state) {
  const { job, timeline, _hidden, market, month } = state;
  let income = 0, expense = 0;

  // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‹ã‚‰åå…¥ãƒ»æ”¯å‡ºè¨ˆç®—
  const placedActions = timeline.filter(Boolean);
  const workHours = placedActions.filter(a => a.category === 'work').length;
  const sleepHours = placedActions.filter(a => a.id === 'sleep').length;

  // åŸºæœ¬åå…¥ Ã— å¸‚å ´ä¿‚æ•° Ã— æ™‚ä»£é©åˆåº¦ Ã— ç–²å¼Šè£œæ­£
  const fatigueMultiplier = 1 - _hidden.fatigue * 0.4;
  const eraMultiplier = 0.5 + _hidden.eraFit;
  const marketMultiplier = market.multiplier;

  if (workHours > 0) {
    income = job.baseIncome * (workHours / 8) * marketMultiplier * eraMultiplier * fatigueMultiplier;
    // åå…¥ã®åˆ†æ•£ï¼ˆä¸ç¢ºå®Ÿæ€§ï¼‰
    income *= (1 + (Math.random() - 0.5) * job.incomeVariance);
  }

  // èµ·æ¥­å®¶: è³‡ç”£ãŒã‚ã‚Œã°åå…¥ç™ºç”Ÿ
  if (job.id === 'entrepreneur') {
    income += state.asset * 0.02 * Math.random() * 3;
  }

  // æŠ•è³‡å®¶: å¸‚å ´ãƒ•ã‚§ãƒ¼ã‚ºã«å¼·ãä¾å­˜
  if (job.id === 'investor') {
    income += state.asset * (market.multiplier - 0.8) * 0.15 * _hidden.skill;
  }

  // ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼: ãƒ©ãƒ³ãƒ€ãƒ æ€§ãŒé«˜ã„
  if (job.id === 'influencer') {
    income += Math.random() < 0.3 ? state.asset * 0.1 * Math.random() : 0;
  }

  // æ”¯å‡º
  placedActions.forEach(a => {
    if (a.cost) expense += a.cost;
  });
  expense += 150000; // åŸºæœ¬ç”Ÿæ´»è²»

  // ç¡çœ ä¸è¶³ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼ˆUIã«ã¯è¡¨ç¤ºã—ãªã„ï¼‰
  const sleepPenalty = Math.max(0, 8 - sleepHours);
  const newFatigue = Math.min(1, _hidden.fatigue + sleepPenalty * 0.05);

  // ã‚¹ã‚­ãƒ«ãƒ»ç¤¾ä¼šä¿¡ç”¨ã®å¤‰å‹•
  const socialActions = placedActions.filter(a =>
    ['networking','volunteer','drink','family'].includes(a.id)
  ).length;

  const newHidden = {
    ..._hidden,
    fatigue: newFatigue,
    socialCredit: Math.min(1, _hidden.socialCredit + socialActions * 0.02),
    skill: Math.min(1, _hidden.skill + placedActions.filter(a =>
      ['learn','study_invest','side_hustle'].includes(a.id)
    ).length * 0.03),
    eraFit: Math.min(1, Math.max(0,
      _hidden.eraFit + placedActions.filter(a => a.id === 'learn').length * 0.02
      - 0.01 // æ™‚ä»£ã¯å¸¸ã«å…ˆã«è¡Œã
    )),
    luck: Math.min(1, Math.max(0,
      _hidden.luck + (Math.random() - 0.48) * 0.05 // ã‚ãšã‹ãªãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯
    )),
  };

  const netChange = Math.floor(income - expense);
  const newAsset = state.asset + netChange;
  const isFire = newAsset >= 500000000; // 5å„„å††ã§FIRE

  return {
    income: Math.floor(income),
    expense: Math.floor(expense),
    netChange,
    newAsset,
    newHidden,
    isFire,
    sleepPenalty,
  };
}

// â”€â”€â”€ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆç¢ºç‡è¨ˆç®— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ã€Œè¦‹ãŸç›®ã¯ãƒ©ãƒ³ãƒ€ãƒ ã€å®Ÿéš›ã¯è‡ªåˆ†ã§ç¢ºç‡ã‚’ä½œã£ã¦ã„ã‚‹ã€
function calculateRouletteProbabilities(state) {
  const { _hidden, job, market, month } = state;

  return ROULETTE_EVENTS.map(ev => {
    let weight = 1.0; // ãƒ™ãƒ¼ã‚¹ç¢ºç‡

    // éš ã—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«ã‚ˆã‚‹æ­ªã¿
    if (ev.type === 'positive') weight *= (0.5 + _hidden.luck);
    if (ev.type === 'negative') weight *= (1.5 - _hidden.luck);
    if (ev.type === 'negative' && _hidden.fatigue > 0.7) weight *= 1.4;
    if (ev.type === 'market') weight *= market.risk;
    if (ev.id === 'burnout') weight *= _hidden.fatigue * 1.5;
    if (ev.id === 'connection') weight *= _hidden.socialCredit * 1.3;
    if (ev.id === 'breakthrough') weight *= _hidden.skill * 0.8;
    if (ev.type === 'neutral') weight *= (1 + (month > 12 ? 0.3 : 0)); // é•·ãç¶šãã¨é™å¯‚ãŒæ¥ã‚‹
    if (_hidden.karmaModifiers?.eventBias === 'adversity' && ev.type === 'positive') weight *= 0.5;

    return { ...ev, weight: Math.max(0.1, weight) };
  });
}

function spinRoulette(state) {
  const probs = calculateRouletteProbabilities(state);
  const total = probs.reduce((s, e) => s + e.weight, 0);
  let r = Math.random() * total;
  for (const ev of probs) {
    r -= ev.weight;
    if (r <= 0) return ev;
  }
  return probs[probs.length - 1];
}

// â”€â”€â”€ æœˆåˆå‡¦ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function determineMonthStart(state, karma) {
  // å¸‚å ´ãƒ•ã‚§ãƒ¼ã‚ºã¯å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ +éå»ã®æµã‚Œè£œæ­£
  const currentIdx = MARKET_PHASES.indexOf(state.market);
  // ç¾åœ¨ãƒ•ã‚§ãƒ¼ã‚ºãŒç¶šãç¢ºç‡40%ã€éš£æ¥ãƒ•ã‚§ãƒ¼ã‚ºã¸ç§»è¡Œ45%ã€æ€¥å¤‰15%
  let marketIdx;
  const r = Math.random();
  if (r < 0.40) {
    marketIdx = currentIdx;
  } else if (r < 0.85) {
    marketIdx = (currentIdx + (Math.random() < 0.5 ? 1 : -1) + MARKET_PHASES.length) % MARKET_PHASES.length;
  } else {
    marketIdx = Math.floor(Math.random() * MARKET_PHASES.length);
  }

  const moodIdx = Math.floor(Math.random() * SOCIAL_MOODS.length);

  return {
    market: MARKET_PHASES[marketIdx],
    mood: SOCIAL_MOODS[moodIdx],
  };
}

// ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆglobalï¼‰
window.NEONLIFE = {
  JOBS, ACTIONS, MARKET_PHASES, SOCIAL_MOODS, EVENTS, ROULETTE_EVENTS,
  loadKarma, saveKarma, getKarmaModifiers,
  createInitialState, calculateMonthEnd, calculateRouletteProbabilities,
  spinRoulette, determineMonthStart,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NEON LIFE â€” UI LAYER
//  è¨­è¨ˆåŸå‰‡: ã€Œæƒ…å ±ãŒå¤šã™ãã¦å…¨éƒ¨ã¯èª­ã‚ãªã„ã€ã€Œæ•°å€¤ãŒè¦‹ãˆã¦ã„ã‚‹ã‚ˆã†ã§æœ¬è³ªãŒéš ã‚Œã‚‹ã€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const { useState, useEffect, useRef, useCallback, useMemo } = React;
// Aliases from window.NEONLIFE (avoids re-declaring consts from data layer)
const _NL = window.NEONLIFE;

// â”€â”€â”€ Canvas: è³‡ç”£ãƒãƒ£ãƒ¼ãƒˆ + FIREé€²æ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AssetCanvas({ history, asset, isFire }) {
  const ref = useRef(null);
  useEffect(() => {
    const cv = ref.current; if (!cv) return;
    const ctx = cv.getContext('2d');
    const dpr = window.devicePixelRatio || 1;
    const W = cv.offsetWidth, H = cv.offsetHeight;
    cv.width = W * dpr; cv.height = H * dpr;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    ctx.clearRect(0, 0, W, H);

    const assets = history.assets;
    if (assets.length < 2) return;

    // FIREç›®æ¨™ãƒ©ã‚¤ãƒ³
    const FIRE_TARGET = 500000000;
    const max = Math.max(FIRE_TARGET * 0.3, ...assets);
    const min = Math.min(0, ...assets);

    const pad = { t: 8, r: 8, b: 20, l: 8 };
    const cw = W - pad.l - pad.r;
    const ch = H - pad.t - pad.b;

    const toX = i => pad.l + (i / (assets.length - 1)) * cw;
    const toY = v => pad.t + ch - ((v - min) / (max - min)) * ch;

    // FIREç›®æ¨™ãƒ©ã‚¤ãƒ³
    const fireY = toY(FIRE_TARGET);
    ctx.strokeStyle = 'rgba(59,130,246,0.2)';
    ctx.lineWidth = 1;
    ctx.setLineDash([4, 4]);
    ctx.beginPath(); ctx.moveTo(pad.l, fireY); ctx.lineTo(W - pad.r, fireY);
    ctx.stroke(); ctx.setLineDash([]);

    // ã‚¼ãƒ­ãƒ©ã‚¤ãƒ³
    const zeroY = toY(0);
    ctx.strokeStyle = 'rgba(239,68,68,0.15)';
    ctx.lineWidth = 0.5;
    ctx.beginPath(); ctx.moveTo(pad.l, zeroY); ctx.lineTo(W - pad.r, zeroY);
    ctx.stroke();

    // è³‡ç”£ãƒ©ã‚¤ãƒ³
    const gradient = ctx.createLinearGradient(0, pad.t, 0, H - pad.b);
    gradient.addColorStop(0, isFire ? 'rgba(59,130,246,0.8)' : 'rgba(34,197,94,0.7)');
    gradient.addColorStop(1, 'rgba(34,197,94,0.1)');

    ctx.beginPath();
    assets.forEach((v, i) => {
      const x = toX(i), y = toY(v);
      i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    });
    ctx.strokeStyle = isFire ? '#3b82f6' : '#22c55e';
    ctx.lineWidth = 1.5; ctx.stroke();

    // å¡—ã‚Šã¤ã¶ã—
    ctx.lineTo(toX(assets.length - 1), zeroY);
    ctx.lineTo(toX(0), zeroY);
    ctx.closePath();
    ctx.fillStyle = gradient; ctx.fill();

    // FIREé€²æ—ãƒ©ãƒ™ãƒ«
    const progress = Math.min(1, Math.max(0, asset) / FIRE_TARGET);
    ctx.fillStyle = 'rgba(59,130,246,0.5)';
    ctx.font = `${10 / dpr * dpr}px 'Syne Mono', monospace`;
    ctx.fillText(`FIRE ${Math.floor(progress * 100)}%`, pad.l + 2, H - 4);
  }, [history, asset, isFire]);

  return React.createElement('canvas', {
    ref,
    style: { width: '100%', height: '100%', display: 'block' }
  });
}

// â”€â”€â”€ ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Timeline({ timeline, onDrop, onRemove, market, month }) {
  const [dragOver, setDragOver] = useState(null);

  // ç¡çœ 8æ™‚é–“ã®ç¢ºèªï¼ˆè¶³ã‚Šãªã„ã¨ãƒ©ãƒ™ãƒ«è¡¨ç¤ºï¼‰
  const sleepHours = timeline.filter(a => a?.id === 'sleep').length;
  const sleepWarning = sleepHours < 8;

  const slotStyle = (idx, action) => ({
    minWidth: 36, height: 52,
    border: `1px solid ${dragOver === idx ? '#3b82f6' : action ? 'rgba(59,130,246,0.3)' : 'rgba(255,255,255,0.06)'}`,
    borderRadius: 3,
    background: action
      ? `hsla(${getCategoryHue(action.category)}, 60%, 12%, 0.9)`
      : dragOver === idx ? 'rgba(59,130,246,0.08)' : 'rgba(255,255,255,0.02)',
    cursor: action ? 'pointer' : 'default',
    display: 'flex', flexDirection: 'column',
    alignItems: 'center', justifyContent: 'center',
    gap: 2,
    transition: 'all 0.15s',
    fontSize: action ? 14 : 10,
    position: 'relative',
    flexShrink: 0,
  });

  return React.createElement('div', { style: { width: '100%' } },
    // æ™‚åˆ»ãƒ©ãƒ™ãƒ«
    React.createElement('div', {
      style: { display: 'flex', gap: 1, marginBottom: 4, padding: '0 2px' }
    },
      Array.from({ length: 24 }, (_, i) =>
        React.createElement('div', {
          key: i,
          style: {
            minWidth: 36, textAlign: 'center',
            fontSize: 9, color: 'rgba(255,255,255,0.2)',
            fontFamily: "'Syne Mono', monospace",
          }
        }, i === 0 ? '00' : i % 6 === 0 ? `${i}` : '')
      )
    ),
    // ã‚¹ãƒ­ãƒƒãƒˆ
    React.createElement('div', {
      style: { display: 'flex', gap: 1, padding: '0 2px', overflowX: 'auto',
        scrollbarWidth: 'none' }
    },
      Array.from({ length: 24 }, (_, i) => {
        const action = timeline[i];
        return React.createElement('div', {
          key: i,
          style: slotStyle(i, action),
          onDragOver: (e) => { e.preventDefault(); setDragOver(i); },
          onDragLeave: () => setDragOver(null),
          onDrop: (e) => {
            e.preventDefault();
            setDragOver(null);
            const actionId = e.dataTransfer.getData('actionId');
            onDrop(i, actionId);
          },
          onClick: () => action && onRemove(i),
        },
          action
            ? [
                React.createElement('span', { key: 'icon', style: { fontSize: 14 } }, action.icon),
                React.createElement('span', {
                  key: 'name',
                  style: { fontSize: 7, color: 'rgba(255,255,255,0.5)',
                    textAlign: 'center', lineHeight: 1.2, maxWidth: 32 }
                }, action.name.slice(0, 3))
              ]
            : React.createElement('span', {
                style: { fontSize: 9, color: 'rgba(255,255,255,0.08)' }
              }, i + 1)
        );
      })
    ),
    // ç¡çœ è­¦å‘Šï¼ˆæ•°å€¤ã§ã¯ãªãã€Œã‚ã¨â—‹hã€ã¨ã„ã†æ›–æ˜§ãªè¡¨ç¤ºï¼‰
    sleepWarning && React.createElement('div', {
      style: {
        marginTop: 6, fontSize: 10,
        color: 'rgba(239,68,68,0.6)',
        fontFamily: "'Syne Mono', monospace",
        letterSpacing: 1,
      }
    }, `ç¡çœ  ${sleepHours}/8h â€” ç–²ã‚ŒãŒè“„ç©ã™ã‚‹ï¼ˆã‹ã‚‚ã—ã‚Œãªã„ï¼‰`)
  );
}

function getCategoryHue(cat) {
  const map = { survival: 160, work: 220, invest: 45, social: 280, health: 120, growth: 190, leisure: 20 };
  return map[cat] || 200;
}

// â”€â”€â”€ è¡Œå‹•ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ActionCard({ action, jobId }) {
  const [dragging, setDragging] = useState(false);

  // è·æ¥­ã¨ã®ç›¸æ€§ã‚’ç¤ºã™ãŒã€Œç›¸æ€§ã‚¹ã‚³ã‚¢ã€ã¯è¦‹ã›ãªã„
  // é›°å›²æ°—ã§ä¼ãˆã‚‹
  const isResonant = action.category === 'work' && jobId === 'salaryman'
    || action.category === 'invest' && jobId === 'investor'
    || action.category === 'social' && jobId === 'influencer';

  return React.createElement('div', {
    draggable: true,
    onDragStart: (e) => {
      e.dataTransfer.setData('actionId', action.id);
      setDragging(true);
    },
    onDragEnd: () => setDragging(false),
    style: {
      padding: '8px 10px',
      background: dragging ? 'rgba(59,130,246,0.15)' : 'rgba(255,255,255,0.03)',
      border: `1px solid ${isResonant ? 'rgba(59,130,246,0.4)' : 'rgba(255,255,255,0.06)'}`,
      borderRadius: 4,
      cursor: 'grab',
      marginBottom: 4,
      transition: 'all 0.15s',
      position: 'relative',
    }
  },
    React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: 8 } },
      React.createElement('span', { style: { fontSize: 14 } }, action.icon),
      React.createElement('div', { style: { flex: 1, minWidth: 0 } },
        React.createElement('div', {
          style: { fontSize: 11, color: 'rgba(255,255,255,0.8)',
            fontFamily: "'Syne Mono', monospace", letterSpacing: 0.5 }
        }, action.name),
        React.createElement('div', {
          style: { fontSize: 9, color: 'rgba(255,255,255,0.3)', marginTop: 2,
            lineHeight: 1.3, fontFamily: "'Nunito', sans-serif" }
        }, action.desc)
      ),
      action.cost > 0 && React.createElement('div', {
        style: { fontSize: 9, color: 'rgba(239,68,68,0.5)', flexShrink: 0,
          fontFamily: "'Syne Mono', monospace" }
      }, `Â¥${(action.cost / 1000).toFixed(0)}k`)
    )
  );
}

// â”€â”€â”€ ã‚¤ãƒ™ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function EventModal({ event, onChoice, hidden }) {
  if (!event) return null;
  return React.createElement('div', {
    style: {
      position: 'fixed', inset: 0, zIndex: 1000,
      background: 'rgba(0,0,0,0.85)',
      display: 'flex', alignItems: 'center', justifyContent: 'center',
      backdropFilter: 'blur(4px)',
    }
  },
    React.createElement('div', {
      style: {
        width: 'min(480px, 90vw)',
        background: '#070d1a',
        border: '1px solid rgba(59,130,246,0.3)',
        borderRadius: 8,
        padding: 28,
        boxShadow: '0 0 60px rgba(59,130,246,0.1)',
      }
    },
      React.createElement('div', {
        style: { fontSize: 28, marginBottom: 12, textAlign: 'center' }
      }, event.icon),
      React.createElement('h3', {
        style: {
          fontSize: 16, color: '#fff', marginBottom: 8,
          fontFamily: "'Syne Mono', monospace",
          letterSpacing: 2, textAlign: 'center',
        }
      }, event.name),
      // é¸æŠè‚¢ï¼ˆãã‚Œãã‚Œã®åŠ¹æœã¯æ›–æ˜§ãªè¨€è‘‰ã§ï¼‰
      React.createElement('div', { style: { display: 'flex', flexDirection: 'column', gap: 8, marginTop: 20 } },
        event.choices.map((choice, i) =>
          React.createElement('button', {
            key: i,
            onClick: () => onChoice(choice),
            style: {
              padding: '12px 16px',
              background: 'rgba(59,130,246,0.06)',
              border: '1px solid rgba(59,130,246,0.25)',
              borderRadius: 4, color: 'rgba(255,255,255,0.85)',
              cursor: 'pointer', textAlign: 'left',
              fontFamily: "'Nunito', sans-serif",
              fontSize: 13, lineHeight: 1.5,
              transition: 'all 0.15s',
            },
            onMouseEnter: (e) => e.currentTarget.style.background = 'rgba(59,130,246,0.15)',
            onMouseLeave: (e) => e.currentTarget.style.background = 'rgba(59,130,246,0.06)',
          }, choice.label)
        )
      ),
      // ã€Œå†…éƒ¨ã¸ã®å½±éŸ¿ã¯éš ã™ã€â€” é¸æŠå¾Œã«narrativeã ã‘è¦‹ã›ã‚‹
    )
  );
}

// â”€â”€â”€ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæ¼”å‡º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RouletteDisplay({ state, onSpin, result, onConfirm }) {
  const [spinning, setSpinning] = useState(false);
  const [displayItems, setDisplayItems] = useState([]);
  const [revealed, setRevealed] = useState(false);
  const ROULETTE_EVENTS = window.NEONLIFE.ROULETTE_EVENTS;

  const handleSpin = () => {
    if (spinning || result) return;
    setSpinning(true);
    setRevealed(false);

    // æ¼”å‡º: ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¶ã‚¢ã‚¤ãƒ†ãƒ ã‚’é«˜é€Ÿã§åˆ‡ã‚Šæ›¿ãˆã‚‹
    let count = 0;
    const maxCount = 20 + Math.floor(Math.random() * 15);
    const interval = setInterval(() => {
      setDisplayItems(
        Array.from({ length: 5 }, () =>
          _NL.ROULETTE_EVENTS[Math.floor(Math.random() * ROULETTE_EVENTS.length)]
        )
      );
      count++;
      if (count >= maxCount) {
        clearInterval(interval);
        setSpinning(false);
        setRevealed(true);
        onSpin();
      }
    }, 80);
  };

  return React.createElement('div', {
    style: {
      position: 'fixed', inset: 0, zIndex: 1000,
      background: 'rgba(0,0,0,0.9)',
      display: 'flex', flexDirection: 'column',
      alignItems: 'center', justifyContent: 'center',
      gap: 20,
      backdropFilter: 'blur(8px)',
    }
  },
    React.createElement('div', {
      style: {
        fontSize: 11, letterSpacing: 4, color: 'rgba(59,130,246,0.6)',
        fontFamily: "'Syne Mono', monospace",
      }
    }, `${state.month}æœˆ â€” é‹å‘½ã®ç•ª`),

    // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆè¡¨ç¤ºåŸŸ
    React.createElement('div', {
      style: {
        display: 'flex', gap: 8, alignItems: 'center',
        height: 90, overflow: 'hidden',
        padding: '0 20px',
      }
    },
      spinning ? displayItems.map((item, i) =>
        React.createElement('div', {
          key: i,
          style: {
            width: 64, height: 80,
            background: 'rgba(59,130,246,0.08)',
            border: '1px solid rgba(59,130,246,0.2)',
            borderRadius: 4,
            display: 'flex', flexDirection: 'column',
            alignItems: 'center', justifyContent: 'center',
            gap: 4, flexShrink: 0,
            opacity: i === 2 ? 1 : 0.3,
          }
        },
          React.createElement('span', { style: { fontSize: 22 } }, item.icon),
          React.createElement('span', { style: { fontSize: 8, color: 'rgba(255,255,255,0.4)',
            fontFamily: "'Syne Mono', monospace" } }, '?')
        )
      ) : revealed && result
        ? React.createElement('div', {
            style: {
              padding: '16px 32px',
              background: 'rgba(59,130,246,0.1)',
              border: '1px solid rgba(59,130,246,0.4)',
              borderRadius: 6,
              textAlign: 'center',
              animation: 'fadeIn 0.3s ease',
            }
          },
            React.createElement('div', { style: { fontSize: 36, marginBottom: 8 } }, result.icon),
            React.createElement('div', {
              style: { fontSize: 14, color: '#fff',
                fontFamily: "'Syne Mono', monospace", letterSpacing: 2 }
            }, result.name),
            React.createElement('div', {
              style: { fontSize: 11, color: 'rgba(255,255,255,0.4)',
                marginTop: 8, fontFamily: "'Nunito', sans-serif",
                maxWidth: 280, lineHeight: 1.5, fontStyle: 'italic' }
            }, result.narrative)
          )
        : React.createElement('div', {
            style: { fontSize: 11, color: 'rgba(255,255,255,0.2)',
              fontFamily: "'Syne Mono', monospace" }
          }, 'â”€ å¾…æ©Ÿä¸­ â”€')
    ),

    // ãƒœã‚¿ãƒ³
    !result
      ? React.createElement('button', {
          onClick: handleSpin,
          disabled: spinning,
          style: {
            padding: '12px 40px',
            background: spinning ? 'rgba(59,130,246,0.05)' : 'rgba(59,130,246,0.15)',
            border: '1px solid rgba(59,130,246,0.4)',
            borderRadius: 4, color: spinning ? 'rgba(255,255,255,0.3)' : '#fff',
            cursor: spinning ? 'not-allowed' : 'pointer',
            fontFamily: "'Syne Mono', monospace",
            fontSize: 12, letterSpacing: 3,
          }
        }, spinning ? '...' : 'SPIN')
      : React.createElement('button', {
          onClick: onConfirm,
          style: {
            padding: '12px 40px',
            background: 'rgba(59,130,246,0.1)',
            border: '1px solid rgba(59,130,246,0.3)',
            borderRadius: 4, color: 'rgba(255,255,255,0.7)',
            cursor: 'pointer',
            fontFamily: "'Syne Mono', monospace",
            fontSize: 12, letterSpacing: 3,
          }
        }, 'æ¬¡ã®æœˆã¸')
  );
}

// â”€â”€â”€ è·æ¥­é¸æŠç”»é¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function JobSelect({ karma, onSelect }) {
  const [hovered, setHovered] = useState(null);
  const JOBS = window.NEONLIFE.JOBS

  // éå»ã®å› æœã‚’è¡¨ç¤ºï¼ˆã€Œäººç”Ÿã¯è¨˜æ†¶ã•ã‚Œã‚‹ã€ï¼‰
  const hasKarma = karma.runs.length > 0;

  return React.createElement('div', {
    style: {
      minHeight: '100vh', background: '#030509',
      display: 'flex', flexDirection: 'column',
      alignItems: 'center', justifyContent: 'center',
      padding: 24,
    }
  },
    // ã‚¿ã‚¤ãƒˆãƒ«
    React.createElement('div', { style: { textAlign: 'center', marginBottom: 40 } },
      React.createElement('h1', {
        style: {
          fontSize: 'clamp(1.8rem, 5vw, 3rem)',
          fontFamily: "'Syne Mono', monospace",
          color: '#3b82f6',
          letterSpacing: 8,
          textShadow: '0 0 40px rgba(59,130,246,0.4)',
          margin: 0,
        }
      }, 'NEON LIFE'),
      React.createElement('p', {
        style: {
          fontSize: 11, color: 'rgba(255,255,255,0.25)',
          letterSpacing: 3, marginTop: 8,
          fontFamily: "'Syne Mono', monospace",
        }
      }, 'ãƒã‚ªãƒ³è¼ãæ±äº¬ã§ã€äººç”Ÿã‚’é¸ã¹'),
    ),

    // å› æœã®è¨˜éŒ²
    hasKarma && React.createElement('div', {
      style: {
        marginBottom: 24, padding: '10px 16px',
        background: 'rgba(239,68,68,0.05)',
        border: '1px solid rgba(239,68,68,0.1)',
        borderRadius: 4, fontSize: 10,
        color: 'rgba(239,68,68,0.4)',
        fontFamily: "'Syne Mono', monospace",
        letterSpacing: 1,
        maxWidth: 500, textAlign: 'center',
      }
    }, `${karma.runs.length}å‘¨ã®è¨˜æ†¶ãŒæ®‹ã£ã¦ã„ã‚‹ â€” ä¸–ç•Œã¯å­¦ç¿’ã™ã‚‹`),

    // è·æ¥­ã‚°ãƒªãƒƒãƒ‰
    React.createElement('div', {
      style: {
        display: 'grid',
        gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
        gap: 12, maxWidth: 700, width: '100%',
      }
    },
      JOBS.map(job =>
        React.createElement('div', {
          key: job.id,
          onClick: () => onSelect(job),
          onMouseEnter: () => setHovered(job.id),
          onMouseLeave: () => setHovered(null),
          style: {
            padding: '16px 18px',
            background: hovered === job.id ? 'rgba(59,130,246,0.08)' : 'rgba(255,255,255,0.02)',
            border: `1px solid ${hovered === job.id ? 'rgba(59,130,246,0.4)' : 'rgba(255,255,255,0.06)'}`,
            borderRadius: 6,
            cursor: 'pointer',
            transition: 'all 0.2s',
          }
        },
          React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: 10, marginBottom: 6 } },
            React.createElement('span', { style: { fontSize: 20 } }, job.icon),
            React.createElement('span', {
              style: { fontSize: 13, color: '#fff',
                fontFamily: "'Syne Mono', monospace", letterSpacing: 1 }
            }, job.name)
          ),
          React.createElement('p', {
            style: { fontSize: 10, color: 'rgba(255,255,255,0.35)',
              lineHeight: 1.6, margin: 0, fontFamily: "'Nunito', sans-serif" }
          }, job.desc),
          React.createElement('div', {
            style: { marginTop: 8, fontSize: 9, color: 'rgba(59,130,246,0.4)',
              fontFamily: "'Syne Mono', monospace" }
          }, job.baseIncome > 0 ? `åŸºæœ¬ Â¥${(job.baseIncome/10000).toFixed(0)}ä¸‡/æœˆ` : 'åå…¥: ä¸å®š')
        )
      )
    )
  );
}

// â”€â”€â”€ ãƒ¡ã‚¤ãƒ³ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function NeonLife() {
  const [screen, setScreen] = useState('jobselect'); // 'jobselect' | 'game' | 'over'
  const [karma, setKarma] = useState(() => loadKarma());
  const [state, setState] = useState(null);
  const [rouletteResult, setRouletteResult] = useState(null);
  const [narrative, setNarrative] = useState('');
  const [showNarrative, setShowNarrative] = useState(false);
  const [activeTab, setActiveTab] = useState('actions'); // 'actions' | 'shop' | 'log'

  // æœˆåˆã®å¸‚å ´ãƒ»ãƒ ãƒ¼ãƒ‰ã‚’æ±ºå®šã—ã¦ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹
  const startGame = useCallback((job) => {
    const newState = createInitialState(job, karma);
    // æœ€åˆã®å¸‚å ´ã‚’è¨­å®š
    const { market, mood } = window.NEONLIFE.determineMonthStart(newState, karma);
    setState({ ...newState, market, mood });
    setScreen('game');
  }, [karma]);

  // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é…ç½®
  const handleDrop = useCallback((slotIndex, actionId) => {
    if (!state || state.phase !== 'timeline') return;
    const action = ACTIONS.find(a => a.id === actionId);
    if (!action) return;

    // è¤‡æ•°ã‚¹ãƒ­ãƒƒãƒˆãŒå¿…è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆä¾‹: æ—…è¡Œ=4hï¼‰
    const slots = action.hours || 1;
    const available = Array.from({ length: slots }, (_, i) => slotIndex + i)
      .every(i => i < 24 && !state.timeline[i]);
    if (!available) return;

    const newTimeline = [...state.timeline];
    for (let i = 0; i < slots; i++) {
      newTimeline[slotIndex + i] = action;
    }
    setState(s => ({ ...s, timeline: newTimeline }));
  }, [state]);

  const handleRemove = useCallback((slotIndex) => {
    if (!state || state.phase !== 'timeline') return;
    const action = state.timeline[slotIndex];
    if (!action) return;

    const newTimeline = [...state.timeline];
    // è¤‡æ•°ã‚¹ãƒ­ãƒƒãƒˆå æœ‰ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å…¨å‰Šé™¤
    newTimeline.forEach((a, i) => {
      if (a === action) newTimeline[i] = null;
    });
    setState(s => ({ ...s, timeline: newTimeline }));
  }, [state]);

  // æœˆæœ«æ±ºç®—ã¸é€²ã‚€
  const handleEndMonth = useCallback(() => {
    if (!state) return;

    // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿåˆ¤å®š
    const EVENTS = window.NEONLIFE.EVENTS
    const triggeredEvents = EVENTS.filter(ev => {
      if (!ev.trigger) return false;
      const t = ev.trigger;
      if (t.tags && !t.tags.some(tag => state.job.eventTags?.includes(tag))) return false;
      if (t.minMonth && state.month < t.minMonth) return false;
      if (t.minFatigue && state._hidden.fatigue < t.minFatigue) return false;
      if (t.minAsset && state.asset < t.minAsset) return false;
      const prob = t.probability || 0.3;
      return Math.random() < prob;
    });

    if (triggeredEvents.length > 0) {
      setState(s => ({
        ...s,
        phase: 'event',
        currentEvent: triggeredEvents[0],
      }));
    } else {
      setState(s => ({ ...s, phase: 'settlement' }));
    }
  }, [state]);

  // ã‚¤ãƒ™ãƒ³ãƒˆé¸æŠ
  const handleEventChoice = useCallback((choice) => {
    if (!state) return;
    const { currentEvent } = state;

    // narrativeè¡¨ç¤º
    setNarrative(choice.narrative);
    setShowNarrative(true);
    setTimeout(() => setShowNarrative(false), 3000);

    // åŠ¹æœé©ç”¨ï¼ˆå†…éƒ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã¿å¤‰æ›´ã€assetå¤‰æ›´ã¯æ±ºç®—æ™‚ï¼‰
    const newHidden = { ...state._hidden };
    const eff = choice.effect || {};
    if (eff.socialCredit) newHidden.socialCredit = Math.min(1, Math.max(0, newHidden.socialCredit + eff.socialCredit));
    if (eff.fatigue) newHidden.fatigue = Math.min(1, Math.max(0, newHidden.fatigue + eff.fatigue));
    if (eff.eraFit) newHidden.eraFit = Math.min(1, Math.max(0, newHidden.eraFit + eff.eraFit));
    if (eff.luck) newHidden.luck = Math.min(1, Math.max(0, newHidden.luck + eff.luck));
    if (eff.skill) newHidden.skill = Math.min(1, Math.max(0, newHidden.skill + eff.skill));

    const newLog = [{
      month: state.month,
      event: currentEvent.name,
      choice: choice.label,
      narrative: choice.narrative,
    }, ...state.log].slice(0, 50);

    const newHistory = {
      ...state.history,
      decisions: [...state.history.decisions, { month: state.month, event: currentEvent.name, choice: choice.label }],
      eventsFaced: [...state.history.eventsFaced, currentEvent.id],
    };

    setState(s => ({
      ...s,
      _hidden: newHidden,
      phase: 'settlement',
      currentEvent: null,
      log: newLog,
      history: newHistory,
    }));
  }, [state]);

  // æ±ºç®—å‡¦ç†
  const handleSettle = useCallback(() => {
    if (!state) return;
    const result = calculateMonthEnd(state);

    const newAsset = Math.max(-10000000, result.newAsset); // å€Ÿé‡‘ã¯-1000ä¸‡ã¾ã§
    const isFire = newAsset >= 500000000;
    const newRedMonths = result.netChange < 0 ? state.redMonths + 1 : 0;
    const isBankrupt = newRedMonths >= 12 || newAsset < -5000000;

    const newHistory = {
      ...state.history,
      assets: [...state.history.assets, newAsset],
      peakAsset: Math.max(state.history.peakAsset, newAsset),
      lowestMonth: result.netChange < 0
        ? (state.history.lowestMonth || state.month)
        : state.history.lowestMonth,
    };

    // ãƒ­ã‚°ã«æœˆæœ«è¨˜éŒ²
    const settlementLog = {
      month: state.month,
      event: 'æœˆæœ«æ±ºç®—',
      choice: `+Â¥${(result.income/10000).toFixed(0)}ä¸‡ / -Â¥${(result.expense/10000).toFixed(0)}ä¸‡`,
      narrative: result.netChange > 0
        ? `${Math.floor(result.netChange/10000)}ä¸‡å††å¢—ãˆãŸ`
        : `${Math.floor(Math.abs(result.netChange)/10000)}ä¸‡å††æ¸›ã£ãŸ`,
    };

    setState(s => ({
      ...s,
      asset: newAsset,
      monthlyIncome: result.income,
      monthlyExpense: result.expense,
      _hidden: result.newHidden,
      phase: isBankrupt ? 'bankrupt' : 'roulette',
      isFire: isFire || s.isFire,
      fireMonth: isFire && !s.isFire ? state.month : s.fireMonth,
      redMonths: newRedMonths,
      history: newHistory,
      log: [settlementLog, ...s.log].slice(0, 50),
    }));

    if (isBankrupt) {
      // å› æœã¨ã—ã¦è¨˜éŒ²
      const newKarma = {
        ...karma,
        runs: [...karma.runs, {
          finalJob: state.job.id,
          endReason: 'bankruptcy',
          months: state.month,
          peakAsset: newHistory.peakAsset,
          decisions: newHistory.decisions,
        }],
        totalMonths: karma.totalMonths + state.month,
      };
      setKarma(newKarma);
      saveKarma(newKarma);
    }
  }, [state, karma]);

  // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ
  const handleSpin = useCallback(() => {
    if (!state) return;
    const result = spinRoulette(state);
    setRouletteResult(result);

    // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆçµæœã‚’å†…éƒ¨ã«é©ç”¨
    const eff = result.effect || {};
    setState(s => {
      const newHidden = { ...s._hidden };
      if (eff.asset) {
        const delta = Math.floor(s.asset * eff.asset);
        return {
          ...s,
          asset: s.asset + delta,
          _hidden: newHidden,
          rouletteResult: result,
          log: [{ month: s.month, event: result.name, choice: '', narrative: result.narrative }, ...s.log].slice(0, 50),
        };
      }
      if (eff.fatigue) newHidden.fatigue = Math.min(1, Math.max(0, newHidden.fatigue + eff.fatigue));
      if (eff.luck) newHidden.luck = Math.min(1, Math.max(0, newHidden.luck + eff.luck));
      if (eff.socialCredit) newHidden.socialCredit = Math.min(1, Math.max(0, newHidden.socialCredit + eff.socialCredit));
      if (eff.skill) newHidden.skill = Math.min(1, Math.max(0, newHidden.skill + eff.skill));
      if (eff.income) {
        // åå…¥ãƒœãƒ¼ãƒŠã‚¹ã¯æ¬¡æœˆã®åŸºæœ¬åå…¥ã«å½±éŸ¿ï¼ˆä¸€æ™‚çš„ï¼‰
      }
      if (eff.asset_volatile) {
        const delta = Math.floor(s.asset * (Math.random() * 0.4 - 0.15));
        return {
          ...s, asset: s.asset + delta,
          _hidden: newHidden, rouletteResult: result,
          log: [{ month: s.month, event: result.name, choice: '', narrative: result.narrative }, ...s.log].slice(0, 50),
        };
      }
      return { ...s, _hidden: newHidden, rouletteResult: result,
        log: [{ month: s.month, event: result.name, choice: '', narrative: result.narrative }, ...s.log].slice(0, 50) };
    });
  }, [state]);

  // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆç¢ºèª â†’ æ¬¡æœˆã¸
  const handleNextMonth = useCallback(() => {
    if (!state) return;

    const { market, mood } = window.NEONLIFE.determineMonthStart(state, karma);
    setState(s => ({
      ...s,
      month: s.month + 1,
      phase: 'timeline',
      timeline: Array(24).fill(null),
      currentEvent: null,
      rouletteResult: null,
      market,
      mood,
      monthlyIncome: 0,
      monthlyExpense: 0,
    }));
    setRouletteResult(null);

    // FIREã«åˆ°é”ã—ãŸã‚‰å› æœã¨ã—ã¦è¨˜éŒ²
    if (state.isFire && state.month > state.fireMonth) {
      const newKarma = {
        ...karma,
        runs: [...karma.runs, {
          finalJob: state.job.id,
          endReason: 'fire',
          months: state.month,
          peakAsset: state.history.peakAsset,
          decisions: state.history.decisions,
        }],
        totalMonths: karma.totalMonths + 1,
      };
      setKarma(newKarma);
      saveKarma(newKarma);
    }
  }, [state, karma]);

  // ç”»é¢: è·æ¥­é¸æŠ
  if (screen === 'jobselect') {
    return React.createElement(JobSelect, { karma, onSelect: (job) => startGame(job) });
  }

  // ç”»é¢: ç ´ç”£
  if (state?.phase === 'bankrupt') {
    return React.createElement('div', {
      style: {
        minHeight: '100vh', background: '#030509',
        display: 'flex', flexDirection: 'column',
        alignItems: 'center', justifyContent: 'center',
        padding: 24,
      }
    },
      React.createElement('div', {
        style: { textAlign: 'center', maxWidth: 400 }
      },
        React.createElement('div', { style: { fontSize: 48, marginBottom: 16 } }, 'ğŸ“‹'),
        React.createElement('h2', {
          style: { fontFamily: "'Syne Mono', monospace", color: 'rgba(239,68,68,0.8)',
            fontSize: 18, letterSpacing: 4, marginBottom: 12 }
        }, 'ç ´ç”£'),
        React.createElement('p', {
          style: { color: 'rgba(255,255,255,0.4)', fontSize: 13, lineHeight: 1.7,
            fontFamily: "'Nunito', sans-serif", marginBottom: 24 }
        }, `${state.month}ãƒ¶æœˆã®äººç”Ÿã ã£ãŸã€‚ãƒ”ãƒ¼ã‚¯è³‡ç”£: Â¥${(state.history.peakAsset/10000).toFixed(0)}ä¸‡å††ã€‚ã“ã‚Œã¯å¤±æ•—ã§ã¯ãªã„ã€‚èªã‚Œã‚‹ç‰©èªã ã€‚`),
        // æ±ºæ–­ã®è¨˜éŒ²
        state.history.decisions.length > 0 && React.createElement('div', {
          style: { marginBottom: 24, textAlign: 'left',
            padding: '12px 16px', background: 'rgba(239,68,68,0.05)',
            border: '1px solid rgba(239,68,68,0.1)', borderRadius: 4 }
        },
          React.createElement('div', { style: { fontSize: 10, color: 'rgba(255,255,255,0.25)',
            fontFamily: "'Syne Mono', monospace", marginBottom: 8, letterSpacing: 2 } }, 'æ±ºæ–­ã®è¨˜éŒ²'),
          state.history.decisions.slice(-5).map((d, i) =>
            React.createElement('div', { key: i, style: { fontSize: 10, color: 'rgba(255,255,255,0.4)',
              fontFamily: "'Nunito', sans-serif", marginBottom: 3 } },
              `${d.month}æœˆ / ${d.event} â†’ ${d.choice}`)
          )
        ),
        React.createElement('button', {
          onClick: () => { setState(null); setScreen('jobselect'); },
          style: {
            padding: '12px 32px', background: 'rgba(239,68,68,0.1)',
            border: '1px solid rgba(239,68,68,0.3)', borderRadius: 4,
            color: 'rgba(255,255,255,0.7)', cursor: 'pointer',
            fontFamily: "'Syne Mono', monospace", fontSize: 12, letterSpacing: 3,
          }
        }, 'å†èµ·ã™ã‚‹')
      )
    );
  }

  if (!state) return null;

  const FIRE_TARGET = 500000000;
  const fireProgress = Math.min(1, Math.max(0, state.asset) / FIRE_TARGET);

  // ã‚²ãƒ¼ãƒ ç”»é¢
  return React.createElement('div', {
    style: {
      minHeight: '100vh', background: '#030509',
      color: 'rgba(255,255,255,0.8)',
      fontFamily: "'Nunito', sans-serif",
      display: 'flex', flexDirection: 'column',
    }
  },
    // â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€
    React.createElement('div', {
      style: {
        padding: '10px 16px',
        borderBottom: '1px solid rgba(255,255,255,0.05)',
        display: 'flex', alignItems: 'center', gap: 16,
        flexWrap: 'wrap', gap: 8,
      }
    },
      // ã‚¿ã‚¤ãƒˆãƒ«
      React.createElement('span', {
        style: { fontFamily: "'Syne Mono', monospace", fontSize: 14,
          color: '#3b82f6', letterSpacing: 4,
          textShadow: '0 0 20px rgba(59,130,246,0.4)', flexShrink: 0 }
      }, 'NEON LIFE'),

      // æœˆæ•°
      React.createElement('span', {
        style: { fontFamily: "'Syne Mono', monospace", fontSize: 11,
          color: 'rgba(255,255,255,0.3)', letterSpacing: 2 }
      }, `${state.month}æœˆç›®`),

      // è³‡ç”£
      React.createElement('span', {
        style: {
          fontFamily: "'Syne Mono', monospace", fontSize: 13,
          color: state.asset < 0 ? 'rgba(239,68,68,0.8)' : 'rgba(255,255,255,0.9)',
          letterSpacing: 1,
        }
      }, state.asset < 0
        ? `â–¼Â¥${(Math.abs(state.asset)/10000).toFixed(0)}ä¸‡ (å€Ÿé‡‘)`
        : `Â¥${(state.asset/10000).toFixed(0)}ä¸‡`),

      // å¸‚å ´ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå¤‰ãˆã‚‰ã‚Œãªã„ã‚‚ã®ï¼‰
      React.createElement('span', {
        style: { fontSize: 10, color: 'rgba(255,255,255,0.3)',
          fontFamily: "'Syne Mono', monospace",
          padding: '2px 6px', border: '1px solid rgba(255,255,255,0.08)',
          borderRadius: 2 }
      }, state.market.name),

      // è·æ¥­
      React.createElement('span', {
        style: { fontSize: 10, color: 'rgba(59,130,246,0.6)',
          fontFamily: "'Syne Mono', monospace", marginLeft: 'auto' }
      }, `${state.job.icon} ${state.job.name}`),

      // FIREçŠ¶æ…‹
      state.isFire && React.createElement('span', {
        style: { fontSize: 10, color: '#3b82f6',
          fontFamily: "'Syne Mono', monospace",
          textShadow: '0 0 8px rgba(59,130,246,0.6)' }
      }, 'ğŸ”¥ FIRE'),
    ),

    // â”€â”€ Canvas (è³‡ç”£ãƒãƒ£ãƒ¼ãƒˆ) â”€â”€
    React.createElement('div', {
      style: {
        height: 60, borderBottom: '1px solid rgba(255,255,255,0.04)',
        padding: '4px 16px',
      }
    },
      React.createElement(AssetCanvas, {
        history: state.history,
        asset: state.asset,
        isFire: state.isFire,
      })
    ),

    // â”€â”€ ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ â”€â”€
    React.createElement('div', {
      style: {
        flex: 1, display: 'grid',
        gridTemplateColumns: '200px 1fr',
        gap: 0, overflow: 'hidden',
      }
    },
      // å·¦ãƒ‘ãƒãƒ«
      React.createElement('div', {
        style: {
          borderRight: '1px solid rgba(255,255,255,0.04)',
          display: 'flex', flexDirection: 'column',
          overflow: 'hidden',
        }
      },
        // ã‚¿ãƒ–
        React.createElement('div', {
          style: { display: 'flex', borderBottom: '1px solid rgba(255,255,255,0.04)' }
        },
          ['actions', 'log'].map(tab =>
            React.createElement('button', {
              key: tab,
              onClick: () => setActiveTab(tab),
              style: {
                flex: 1, padding: '8px 4px',
                background: 'none', border: 'none',
                borderBottom: `2px solid ${activeTab === tab ? '#3b82f6' : 'transparent'}`,
                color: activeTab === tab ? '#3b82f6' : 'rgba(255,255,255,0.25)',
                fontFamily: "'Syne Mono', monospace",
                fontSize: 9, letterSpacing: 1, cursor: 'pointer',
                transition: 'all 0.15s',
              }
            }, tab === 'actions' ? 'è¡Œå‹•' : 'ãƒ­ã‚°')
          )
        ),
        // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
        React.createElement('div', {
          style: { flex: 1, overflow: 'auto', padding: 8, scrollbarWidth: 'none' }
        },
          activeTab === 'actions'
            ? ACTIONS.map(action =>
                React.createElement(ActionCard, {
                  key: action.id, action, jobId: state.job.id
                })
              )
            : state.log.slice(0, 20).map((entry, i) =>
                React.createElement('div', {
                  key: i,
                  style: {
                    padding: '6px 0',
                    borderBottom: '1px solid rgba(255,255,255,0.04)',
                    fontSize: 9,
                  }
                },
                  React.createElement('div', {
                    style: { color: 'rgba(59,130,246,0.5)',
                      fontFamily: "'Syne Mono', monospace", marginBottom: 2 }
                  }, `${entry.month}æœˆ / ${entry.event}`),
                  entry.choice && React.createElement('div', {
                    style: { color: 'rgba(255,255,255,0.4)', marginBottom: 2 }
                  }, `â†’ ${entry.choice}`),
                  React.createElement('div', {
                    style: { color: 'rgba(255,255,255,0.25)', fontStyle: 'italic' }
                  }, entry.narrative)
                )
              )
        )
      ),

      // å³ãƒ‘ãƒãƒ«: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ + æ“ä½œ
      React.createElement('div', {
        style: { display: 'flex', flexDirection: 'column', overflow: 'hidden', minWidth: 0 }
      },
        // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
        React.createElement('div', {
          style: {
            padding: '12px 12px 8px',
            borderBottom: '1px solid rgba(255,255,255,0.04)',
          }
        },
          React.createElement('div', {
            style: { fontSize: 9, color: 'rgba(255,255,255,0.2)',
              fontFamily: "'Syne Mono', monospace", letterSpacing: 2,
              marginBottom: 6 }
          }, `â”€ 24æ™‚é–“ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ (${state.phase === 'timeline' ? 'é…ç½®ä¸­' : 'ç¢ºå®š'})`),
          React.createElement(Timeline, {
            timeline: state.timeline,
            onDrop: handleDrop,
            onRemove: handleRemove,
            market: state.market,
            month: state.month,
          })
        ),

        // æœˆæœ«ã¸ã®ãƒœã‚¿ãƒ³ / æ±ºç®—æƒ…å ±
        React.createElement('div', {
          style: { padding: '10px 12px', flex: 1, overflow: 'auto',
            scrollbarWidth: 'none' }
        },
          state.phase === 'timeline' && React.createElement('div', {
            style: { display: 'flex', gap: 8, alignItems: 'center' }
          },
            React.createElement('button', {
              onClick: handleEndMonth,
              style: {
                padding: '10px 24px',
                background: 'rgba(59,130,246,0.12)',
                border: '1px solid rgba(59,130,246,0.35)',
                borderRadius: 4, color: 'rgba(255,255,255,0.8)',
                cursor: 'pointer',
                fontFamily: "'Syne Mono', monospace",
                fontSize: 11, letterSpacing: 2,
                transition: 'all 0.15s',
              },
              onMouseEnter: (e) => e.currentTarget.style.background = 'rgba(59,130,246,0.2)',
              onMouseLeave: (e) => e.currentTarget.style.background = 'rgba(59,130,246,0.12)',
            }, `${state.month}æœˆã‚’çµ‚ãˆã‚‹`),
            state.isFire && React.createElement('span', {
              style: { fontSize: 10, color: 'rgba(255,255,255,0.2)',
                fontFamily: "'Syne Mono', monospace" }
            }, 'â€” FIREã—ãŸã€‚ã§ã‚‚ä¸–ç•Œã¯ç¶šã')
          ),

          state.phase === 'settlement' && React.createElement('div', {
            style: { display: 'flex', flexDirection: 'column', gap: 8 }
          },
            React.createElement('div', {
              style: { padding: '10px 14px', background: 'rgba(255,255,255,0.03)',
                border: '1px solid rgba(255,255,255,0.06)', borderRadius: 4 }
            },
              React.createElement('div', { style: { fontSize: 10, color: 'rgba(255,255,255,0.3)',
                fontFamily: "'Syne Mono', monospace", marginBottom: 6 } }, 'æœˆæœ«æ±ºç®—'),
              React.createElement('div', { style: { fontSize: 12, color: 'rgba(34,197,94,0.8)',
                fontFamily: "'Syne Mono', monospace" } },
                `åå…¥: Â¥${(state.monthlyIncome/10000).toFixed(1)}ä¸‡`),
              React.createElement('div', { style: { fontSize: 12, color: 'rgba(239,68,68,0.8)',
                fontFamily: "'Syne Mono', monospace" } },
                `æ”¯å‡º: Â¥${(state.monthlyExpense/10000).toFixed(1)}ä¸‡`),
            ),
            React.createElement('button', {
              onClick: handleSettle,
              style: {
                padding: '10px 24px', background: 'rgba(59,130,246,0.1)',
                border: '1px solid rgba(59,130,246,0.3)', borderRadius: 4,
                color: 'rgba(255,255,255,0.7)', cursor: 'pointer',
                fontFamily: "'Syne Mono', monospace", fontSize: 11, letterSpacing: 2,
              }
            }, 'ç¢ºå®šã™ã‚‹')
          ),
        ),

        // ç¤¾ä¼šãƒ ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆå°ã•ãï¼‰
        React.createElement('div', {
          style: {
            padding: '6px 12px',
            borderTop: '1px solid rgba(255,255,255,0.04)',
            display: 'flex', gap: 12, alignItems: 'center',
          }
        },
          React.createElement('span', { style: { fontSize: 9, color: 'rgba(255,255,255,0.2)',
            fontFamily: "'Syne Mono', monospace" } }, state.mood.name),
          // FIREé€²æ—ã‚’å°ã•ã
          React.createElement('span', { style: { fontSize: 9, color: 'rgba(59,130,246,0.3)',
            fontFamily: "'Syne Mono', monospace", marginLeft: 'auto' } },
            `FIRE ${Math.floor(fireProgress * 100)}%`)
        )
      )
    ),

    // â”€â”€ ãƒ¢ãƒ¼ãƒ€ãƒ«ç¾¤ â”€â”€
    state.phase === 'event' && state.currentEvent &&
      React.createElement(EventModal, {
        event: state.currentEvent,
        onChoice: handleEventChoice,
      }),

    state.phase === 'roulette' &&
      React.createElement(RouletteDisplay, {
        state,
        onSpin: handleSpin,
        result: rouletteResult,
        onConfirm: handleNextMonth,
      }),

    // ãƒŠãƒ©ãƒ†ã‚£ãƒ–è¡¨ç¤ºï¼ˆä¸€ç¬ã ã‘ï¼‰
    showNarrative && React.createElement('div', {
      style: {
        position: 'fixed', bottom: 24, left: '50%',
        transform: 'translateX(-50%)',
        padding: '10px 20px',
        background: 'rgba(0,0,0,0.85)',
        border: '1px solid rgba(255,255,255,0.1)',
        borderRadius: 4, fontSize: 11,
        color: 'rgba(255,255,255,0.6)',
        fontFamily: "'Nunito', sans-serif",
        fontStyle: 'italic', maxWidth: '60vw', textAlign: 'center',
        lineHeight: 1.5, zIndex: 2000,
        backdropFilter: 'blur(4px)',
      }
    }, narrative)
  );
}

window.NeonLifeApp = NeonLife;

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(window.NeonLifeApp));
</script>
</body>
</html>