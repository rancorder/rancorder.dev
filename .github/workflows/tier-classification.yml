name: Tier Classification

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'content/blog/**/*.html'
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'content/blog/**/*.html'

jobs:
  classify-articles:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Classify articles by Tier
        run: node scripts/lint-blog-articles.js
        continue-on-error: false  # å¤±æ•—æ™‚ã¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’åœæ­¢
      
      - name: Upload classification report (on failure)
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: tier-classification-report
          path: |
            content/blog/**/*.html
          retention-days: 7
      
      - name: Comment on PR (on failure)
        if: failure() && github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## ğŸ”´ Tier 2 åˆ¶ç´„é•åãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ
              
              ã“ã®PRã«å«ã¾ã‚Œã‚‹è¨˜äº‹ãŒ Tier 2 ã®åˆ¶ç´„ã«é•åã—ã¦ã„ã¾ã™ã€‚
              
              è©³ç´°ã¯ä¸Šè¨˜ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
              
              ### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
              
              1ï¸âƒ£ **åˆ¶ç´„ã‚’å®ˆã£ãŸå®Ÿè£…ã«ä¿®æ­£ã™ã‚‹ï¼ˆTier 2 ç¶­æŒï¼‰**
              - \`<form>\`ã€\`localStorage\`ã€\`fetch()\` ãªã©ã‚’å‰Šé™¤
              - åˆ¶ç´„ã®è©³ç´°ã¯ [ä»•æ§˜æ›¸ v3.1](docs/spec-v3.1.md) ã‚’å‚ç…§
              
              2ï¸âƒ£ **tier: 3 ã‚’å®£è¨€ã™ã‚‹ï¼ˆä¿è¨¼å¤–ã¨ã—ã¦å…¬é–‹ï¼‰**
              - è¨˜äº‹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã« \`tier: 3\` ã‚’è¿½åŠ 
              - è¨˜äº‹å†…ã«è­¦å‘Šï¼ˆ\`<callout-box type="warning">\`ï¼‰ã‚’è¿½åŠ 
              
              ### é‡è¦
              ã“ã® CI failure ã¯ã€Œãƒã‚°ã€ã§ã¯ãªãã€**è‡ªå‹•é™æ ¼ã®é€šçŸ¥**ã§ã™ã€‚
              ã©ã¡ã‚‰ã‚’é¸æŠã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ãŒã€è²¬ä»»ç¯„å›²ã‚’æ˜ç¢ºã«ã™ã‚‹ãŸã‚ã€
              å¿…ãšã©ã¡ã‚‰ã‹ã®å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`
            })
